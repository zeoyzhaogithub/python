# 第一部分 意识形态：强大且可重复的生物信息学的数据技能

## 第一章、如何学习生物信息学

&emsp;&emsp;现在，在世界各地的实验室里，机器正在对地球上生命的基因进行测序。即使成本迅速下降，基因组测序技术也有例如巨大进步，我们也只能看到每个细胞、组织、有机体和生态系统中包含的生物信息的一小部分。然而，我们正在收集的全部生物信息中的一小部分相当于生物学家需要处理的大量数据。在人类历史上，我们对生活复杂性的理解能力从未像现在这样如此依赖于我们处理和分析数据的技能。

&emsp;&emsp;这本书是关于通过发展数据技能来学习生物信息学的。在本章中，我们将了解什么是数据技能，以及为什么学习数据技能是学习生物信息学的最佳方法。我们还将研究什么是可靠和可重复的研究。

### 为什么是生物信息学？生物学持续增长的数据

&emsp;&emsp;生物信息学家关注的是用专门的技能工具分析大量的数据中获取对生物的理解。在生物学的早期历史中，这些数据集很小且易于管理。大多数生物信息学家，在学习过统计的课程之后，都可以在自己的电脑上利用微软的Excel分析他们的生物信息数据。然而，这一切都在迅速被改变。大规模的测序数据开始应用，而且在未来的应用汇更加广泛。分析这些数据需要不同的工具、新的技能和许多具有大量内存、处理能力和磁盘空间的计算机。

&emsp;&emsp;在短期内由于测序成本大幅下降，使研究人员能够利用测序数据帮助回答重要的生物学问题。早期测序比较苦难而且成本很高。全基因组测序工作代价高昂(人类基因组的测序成本约为27亿美元)，而且只有通过大规模的合作努力才有可能实现。自人类基因组发布以来，测序成本从2008年开始一直呈指数下降，具体如图1-1所示。随着下一代测序技术的引入，DNA测序的成本下降得更快。在这个关键时刻，以前只有大型合作测序机构(或财力非常雄厚的个人研究人员)才能负担得起的技术，现在对于所有生物学领域的研究人员来说都能负担得起了。阅读这本书很可能是为了学习如何处理测序数据，而这些数据在10年产生的成本会非常昂贵。

![图1-1](../../img/1-1.png)

图1-1、2008年前后排序成本的下降是由于引入了下一代测序数据（图转载，数据从国家卫生研究院下载[NIH](https://www.genome.gov/about-genomics/fact-sheets/Sequencing-Human-Genome-cost))

&emsp;&emsp;这些使测序成本下降的新技术将会导致什么后果呢？正如你所猜到的那样，数据越来越多。随着数据越来越多，生物数据库也经历了指数增长。过去，协作者之间共享小型数据库就足够了，而现在全世界的服务器上都有千兆字节的有用数据。生物学问题的关键数据不仅存在于硬盘上未经分析的实验数据中，而且还存储在数千英里之外的数据中心的磁盘上。

&emsp;&emsp;生物数据库的增长就像测序成本的下降一样令人震惊。例如，考虑[序列读取存档](https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?)(以前称为短文档)。自2010年以来，它经历了显著的增长(见图1-2)。

![图1-2](../../img/1-2.png)

图1-2、短读档案馆呈指数增长；开放存取库是向公众提供SRA提交的材料(附图和从[NIH](https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?)下载的数据)

&emsp;&emsp;通过参考摩尔定律，可以将测序数据的这种令人难以置信的增长规律放在上下文中。戈登·摩尔(英特尔的创始人之一)观察到，计算机芯片中的晶体管数量大约每两年翻一番。每片晶体管越多，计算机处理器的速度就越快，计算机的随机存取内存也就越多，从而使计算机功能更强大。这种非同寻常的技术进步速度-产出每两年翻一番-可能是人类有史以来技术增长最快的一次。然而，自2011年以来，存储在“短读档案馆”中的排序数据的数量甚至超过了这一惊人的增长速度，每年都会翻一番。

&emsp;&emsp;分析生物数据的新工具层出不穷，它们的基本算法也在不断进步，使事情变得更加复杂。2012年的一项审查列出了70多个短读映射器（具体见[http://bit.ly/htsmappers](http://bit.ly/htsmappers)）。同样，在过去的五年里，我们的基因组组装方法发生了很大的变化，随着短的高通量测序读取的出现，组装长序列的方法(如重叠-布局-共识算法)被放弃了。现在，测序化学的进步正在导致更长的测序读取长度，新的算法正在取代其他只有几年历史的算法。

&emsp;&emsp;不幸的是，生物信息学工具的这种丰富和快速的发展有严重的不利之处。通常，生物信息学工具没有进行充分的基准测试，或者，如果有，它们也仅仅只在一个有机体中进行基准测试。这使得新的生物学家很难筛选出最好的工具来分析他们的数据。一些生物信息学程序因为没有被积极地开发，使它们失去相关性或带有可能对结果产生负面影响的bug，这使事情变得更加困难。所有这一切使得，选择一个适合生物信息学研究中的程序变得十分困难。更重要的是，需要严格评估自己的数据在生物信息学程序上运行输出结果的准确性。在整个第II部分的示例中，我们将看到数据技能如何帮助我们评估程序输出结果。

### 通过学习数据技能学习生物信息学

&emsp;&emsp;生物数据的性质变化如此之快，该如何学习生物信息学呢？在现在市场上如此多的分析工具，以及不断创造出的新工具中，一个生物学家应该如何选择一个适合他的数据结构，并能对这些数据做出合理分析的工具呢？

&emsp;&emsp;解决办法就是像生物信息学专家那样对待生物信息学：不断尝试，并对结果进行合理评估。通过这种方式，生物信息学变成拥有使用计算机进行数据实验并分析结果技能的学科。对大多数科学家来说实验部分自然而然是很容易的。对大多数生物学家来说，在计算机上自由实验并处理大量数据的数据技能是他们的短板。这本书的目标是教你必要的生物信息学数据技能，使你可以像在实验室里运行实验一样轻松地在计算机上进行数据实验。

&emsp;&emsp;不幸的是，许多生物学家常用的计算工具无法满足现代复杂且规模庞大的生物数据的需求。复杂的数据格式、众多程序的接口以及评估软件和数据使得大型生物信息学数据集的处理非常困难。学习核心生物信息学数据技能将为您提供学习、应用和评估任何生物信息学程序或分析方法的基础。10年后，生物信息学人员可能只使用现今的少数几个生物信息学软件程序。但我们肯定会利用数据技能和实验来评估未来的数据和方法。

&emsp;&emsp;那么什么是数据技能呢？它们是一组计算技能，使您能够使用一套众所周知的工具快速创建一种查看复杂数据集的方法。一个很好的比喻就是爵士音乐家所说的有“演奏技巧（chops）”。一位拥有好演奏技巧的爵士音乐家可以走进一家夜总会，听一首熟悉的标准歌曲，识别和弦的变化，并开始在这些和弦上演奏音乐思想。同样，具有良好数据技能的生物信息学家再收到一个庞大的测序数据集时，能够立刻使用一组工具来查看数据背后所隐藏的内容。

&emsp;&emsp;就像一位精通乐器的爵士乐演奏家一样，一位拥有精湛数据技能的生物信息专家需要掌握一套工具的使用。学习工具是发展数据技能的必要步骤，但不是充分的步骤(同样，学习乐器是演奏音乐思想的必要步骤，但不是充分步骤)。在这本书中，我们将发展我们的数据技能，在第二部分学习创建生物信息学项目和数据，第三部分针对不同数据量的分析工具。然而，这本书只能让你走上正确的生物信息学道路；真正的掌握这些技能，需要在实际项目中反复应用技能进行联系和巩固。

### 可复用性和健壮性研究面临的新挑战

&emsp;&emsp;生物学越来越多地使用大型测序数据集，改变的不仅仅是我们所需要的工具和技能：它也改变了我们的科学发现的可再现性和健壮性。当我们使用新的工具和技术来分析基因组数据时，有必要确保我们的方法仍然像其他任何实验方法一样具有重现性和健壮性。不幸的是，我们的数据的大小和我们分析工作的复杂性使得这些目标在基因组学中特别困难。

&emsp;&emsp;最重要的是我们共享我们的数据和方法。在前基因组学时代，共享数据很容。论文可以包括详细的方法总结和完整的数据集-就像Kreitman在1986年的论文中对4713bp的ADH基因侧翼序列所做的那样(它被嵌入到论文的中间)。现在的论文有很长的补充方法、代码和数据。共享数据也不再是一件简单的事情，因为排序项目可能包括TB字节的附带数据。因为分析中使用的参考基因组和注释数据集不断更新，使得重复性变得更棘手。指向补充材料、方法和期刊网站数据的链接中断，当教职员工移动或更新他们的网站时，教职员工网站上的材料就会消失，而当开发人员离开而不更新代码时，软件项目就会变得陈旧。贯穿这本书，我们将看看在做实际的分析的同时，可以做什么来提高你的项目的再现性，因为我相信这些是必要的补充内容。

&emsp;&emsp;此外，生物信息学分析的复杂性可能导致发现易受错误和技术混乱的影响。即使是相当常规的基因组项目也可以使用几十种不同的程序，复杂的输入参数组合，以及许多样本和注释数据集；此外，工作可能分布在不同的服务器和工作站上。最终的结果是，研究可能会在一个摇摇欲坠的脚手架上进行许多加工步骤。更糟糕的是，生物信息学的工作流程和分析通常只为了出版物生成结果而运行一次，然后再也不运行或测试。这些分析依赖于所使用的所有软件特定的版本，这使得在不同的系统上重现变得异常困难。在学习生物信息学数据技能时，需要同时学习可再现性和健壮的最佳实践版本。让我们依次看一下再现性和健壮性。

### 可复现性研究

&emsp;&emsp;复现科学发现是确认其准确性的唯一方法，而不是单个实验或分析的产物。卡尔·波普尔(KarlPopper)在《科学发现的逻辑》(Te Logic Of Science Fc Discovery)一书中曾说过一句著名的话：“不可复制的单个事件对科学没有意义”(1959年)。我们评估科学发现有效性的黄金标准是实验和分析结果的独立可复现行。不幸的是，大多数测序实验太昂贵，不能从试管上复制，所以我们越来越多地依赖于电子的再现性。生物信息学项目的复杂性通常会阻碍其复现性，因此作为优秀的科学家，我们的工作就是通过鼓励使用更容易地电子可再现性，促进可复现性的发展。正如我们稍后将会看到的那样，作为一名研究员采用良好的可再现性实践可以使您的生活更加轻松。

&emsp;&emsp;那么什么是可重复的生物信息学项目呢？至少，它的项目的代码和数据是可以共享的。大多数期刊和资助机构都要求您共享项目的数据，而像NCBI的Sequence Read Archive这样的资源也是为此目的而存在的。现在，编辑和审阅者通常会建议(或在某些情况下要求)共享项目的代码，特别是如果代码是研究结果的重要部分更应该共享。然而，我们可以而且应该做更多的事情来确保我们的项目的可再现性。通过复现生物信息学分析来验证结果，让我学到了细节的重要性。

&emsp;&emsp;例如，我和同事曾经很难复现我们自己曾经做过的RNA-seq差异表达分析。我们在几周前对一组样本进行了初步分析，但令我们惊讶的是，我们目前的分析结果中产生的差异表达基因的数量比几周前要少得多。在重新检查我们过去的结果是如何创建的，比较数据版本和文件创建时间，以及查看分析代码中的差异之后，我们仍然感到困惑-没有任何东西可以解释结果之间的差异。最后，我们检查了R包的版本，发现服务器上的版本更新了。然后，我们重新安装了旧版本，发现，两次实验结果的不同确实是由R包的版本变更引起的。这里的教训是，将来无论是自己还是其他人，复制通常不仅依赖于数据和代码，还依赖于诸如软件版本、数据下载时间和版本等细节。这种元数据，或关于数据的数据，是确保可再现性的关键细节因素。

&emsp;&emsp;生物信息学可再现性方面的另一个激励案例研究是所谓的“杜克传奇”(DukeSaga)。Anil Potti博士和杜克大学的其他研究人员发明了一利用高通量微阵列的表达数据来检测和预测不同化疗药物疗效的测试方法。这些方法开创了个体化用药的新方式，并且在临床试验中用该方法确定患者的化疗方案。然而，两位生物统计学家KeithBaggly和KevinCoombes尝试复现这项研究时发现，这个分析中存在严重缺陷(Baggly和Coombes，2009年)。据Baggly和Coombes所说，在复现这一分析过程中，并没有足够的文档能证明有许多需要“法医生物信息学”来证明的内容。总之，Baggly和Coombes发现了许多严重错误，包括：

1. 一个off-by-one错误，完整的基因表达值列表相对于它们的对照品值被向下移动。
2. 所使用的微阵列上没有两个生物学上感兴趣的离群点基因。
3. 样本组名称相互混淆

&emsp;&emsp;Baggly和Coombes的研究结果总结并发表了文章《从细胞系中获得化疗敏感性》：法医生物信息学和高吞吐量生物学中的可再生研究(请参阅本章的GitHub目录以获得这篇文章和更多关于杜克传奇的信息)。Baggly和Coombes工作的教训是：“常见的错误是简单的，简单的错误是常见的”，糟糕的文档会导致错误和结果的不可复现性。方法、数据版本和代码的文档化不仅会促进重复性，而且很可能会避免研究过程中的一些严重错误。在你的项目中尽可能的做到可复现性，会使你的项目更加健壮。

### 稳健性研究与生物信息学的黄金法则

>>Since the computer is a sharp enough tool to be really useful, you can cut yourself on it.

>>— The Technical Skills of Statistics
John Tukey(1964) 

&emsp;&emsp;在生物学验室中，实验失败的结果是非常明显的，但在计算分析中，失败与否并不明显。跑电泳凝胶的痕迹看起来像罗夏墨迹，而不是整齐的条带，这清楚地表明结果不正确。在计算科学中，错误可能是无声的，即代码和程序可能会产生输出(而不是因错误而停止)，但这种输出可能是不正确的。这在生物信息学学习过程中是非常重要的一个概念。

&emsp;&emsp;此外，在科学计算中，代码只运行一次是很常见的，因为研究人员会得到他们想要的输出，然后进入下一步。相比之下，考虑一下电子游戏：它可以在数千台(如果不是数百万台)不同的机器上运行，实际上，许多用户都在不断地对它进行测试。如果出现删除用户分数的错误，用户很快就会注意到并进行反馈。不幸的是，大多数生物信息学项目并不会有这样的情况出现。

&emsp;&emsp;基因组学数据的复杂性也为强有力的研究带来了自己的挑战。首先，大多数生物信息学分析产生的中间输出数据量太大且数据维度较高，很难通过肉眼检查去发现问题。大多数分析会涉及多个步骤，因此，即使可以检查整个中间数据集是否存在问题，也很难对每个步骤执行此操作进行数据检查(因此，我们通常使用检查数据样本或查看数据汇总统计信息来解决这个问题)。其次，在生物学实验室中，通常更容易事先推测出实验的预期结果。例如，研究人员可能期望在某些组织中看到某种mRNA的表达现象低于特定的管家基因。有了这些先前的期望，一个异常的结果可以归咎于结果分析的失败，而不是生物学原理错误。相比之下，大多数基因组学结果数据的高维性使得人们几乎不可能预测结果。通过RNA-seq实验对成千上万个基因中的每一个基因的表达形成特定的事先预期是不切实际的。不幸的是，如果没有事先的期望，就很难区分好结果的好坏。

&emsp;&emsp;生物信息学人员还必须警惕生物信息学程序，即使是大型的经过社区审查的工具，如校准器和装配器，在它们的特定有机体上也可能不能很好地工作。生物体都是奇妙的，并且他们的生物信息学基因组也是各不相同。许多生物信息学工具都是在像人类这样的二倍体生物模型上进行测试的，而在生命树其他部分的复杂基因组的测试则不是很容易实现。我们真的期望一个短读数对齐器的开箱即用参数能够对一个四倍大小的多倍体基因组起作用吗？也许不会吧。
确保一切正常工作的简单方法是采取谨慎的态度，并检查计算步骤之间的所有内容。此外，您应该以一种怀疑的态度对待生物学数据(无论是来自实验还是来自数据库的数据)。在计算机界，这与“垃圾输入，垃圾输出”的概念有关-分析的好坏取决于输入数据的质量。

&emsp;&emsp;在生物信息学的教学中，我经常把这个想法作为生物信息学的黄金法则来分享：

&emsp;&emsp;&emsp;&emsp;***永远不要相信你的工具(或数据)。***

&emsp;&emsp;这并不是让你偏执于没有一个生物信息学是可信的，或者你必须测试你的数据上的每一个可用的程序和参数。相反，这是为了训练你采取同样谨慎的态度，软件工程师和生物信息专家已经学会了这种方法。简单地检查输入数据和中间结果，快速运行的健康检查，保持适当控制，使用测试程序都是一个很好的开始。这也可以避免您在以后遇到错误，毕竟修复错误意味着做大量的重复工作。您也可以测试实验室技术是否起作用并给出一致的结果；对生物信息学采用一种健壮的方法仅仅是在生物信息学分析中使用。

### 采用健壮和可复现的实验会使您的工作更轻松。

&emsp;&emsp;在科学领域的工作教会了我们许多人生活是很艰难的这一事实。这就像墨菲定律：任何可能出错的事都会发生。生物信息学有它自己的一套这样的规律。在实地工作并与其他生物信息专家讨论过战争故事之后，我几乎可以保证会发生以下情况：

1. 几乎可以肯定的是，您必须不止一次地重新运行分析，也可能需要使用新的或更改的数据。这种情况经常发生，因为您会发现错误，协作者会添加或更新文件，或者您希望尝试某个步骤的上游新内容。在所有情况下，下游分析都依赖于这些早期的结果，这意味着需要重新运行分析的所有步骤。
2. 将来，您(或您的同事或顾问)肯定需要重复的研究项目种某个看来很难理解的部分。你唯一的解决办法就是记录下每一步的运行结果和过程。如果不写下关键步骤(例如，从何处下载数据、何时下载以及运行了哪些步骤)，您肯定会忘记它们。记录你的计算工作相当于保存一本详细的实验室笔记本-这是科学工作的一个绝对关键的部分。

&emsp;&emsp;幸运的是，多次测试确保您项目具有可再现性有助于解决这些问题。从这个意义上说，生物信息学(和一般的科学计算)良好实践既使生活变得更容易，也导可以使项目可复现性更高。原因很简单：如果您项目的每个步骤都经过多次运行(可能使用不同的数据)，并且详细记录了各个步骤的具体内容，那么可以很好地实现可重现性。

&emsp;&emsp;例如，如果我们使用脚本自动执行任务，并跟踪所有输入数据和软件版本，则只需要按下键盘就可以可重新运行分析数据。优良的脚本自然会记录工作流，因此复制此脚本中的所有步骤很容易(我们将在第12章中详细讨论这个问题)。此方法还可节省您的时间：如果您接收到新的或更新的数据，您只需要用替换后的新文件重新运行脚本。这并不难；脚本并不难编写，计算机也很擅长执行脚本中列举的重复任务。

### 对稳健研究的建议

&emsp;&emsp;程序健壮性研究在很大程度上是经过多次测试，消除一些微小的错误对实验结果的叠加影响。如上所述，除了防止可怕的无声错误之外，大多数这些做法也是有益的-这更有理由在您的日常生物信息学工作中应用下面的建议。

### 注重实验设计

&emsp;&emsp;程序健壮性研究始于良好的实验设计。不幸的是，任何聪明的分析都不能挽救一个设计糟糕的实验。引用一位杰出的统计学家和遗传学家的话说：
>>To consult the statistician after an experiment is finished is often merely to ask him to conduct a post mortem examination. He can perhaps say what the experiment died of.

>>—R.A. Fisher

&emsp;&emsp;这句话形容的很贴切；在花费了数千美元的测序费后，一些项目落在我的办公桌上准备进行分析，但它们在到达时就完全死了。设计一个健壮的实验并不困难，但是因为它从根本上是一个统计主题，所以它超出了本书的范围。我之所以提到这个主题，是因为不幸的是，这本书中没有任何东西能挽救一个设计糟糕的实验。特别有必要在高通量研究中考虑实验设计，因为技术上的“批量效应”可能会极大地影响研究结果(关于这一点的观点，见Leek等人2010年)。

&emsp;&emsp;大多数入门统计课程和书籍涵盖了实验设计的基本主题。Quinn和Keough的《生物学家的实验设计和数据分析》(剑桥大学出版社，2002年)是一本关于这一主题的优秀著作。《统计数据》（Statistics in a Nutshell O’Reilly Sarah Boslaugh 第二版）第18章也涵盖了这方面的基础内容。不过，请注意，基因组学实验中的实验设计会有不同的挑战，但是已经有学者正在积极地研究和改进。确保你的几千美元实验能够发挥其潜力的最好方法就是看看你的特定项目目前的最佳设计实践是什么。向您当地友好的统计员咨询任何实验设计问题或您可能在计划一项实验时所关心的问题，是一个很好的主意。

### 为人类编写代码，为计算机编写数据

>>Debugging is twice as hard as writing the code in the first place. Therefore, if you write
the code as cleverly as possible, you are, by definition, not smart enough to debug it.

>>—Brian Kernighan

&emsp;&emsp;生物信息学项目会包含大量的代码，我们对抗bug最好的方式是为人类编写代码，而不是为计算机编写代码(Wilson等人在2012年的一篇优秀文章中提出了这一点)。调试是由人来完成的，所以编写简单、清晰的代码可以使调试变得更容易。

&emsp;&emsp;代码应该是可读的，分解成包含的小组件(模块化)和可重用的(因此，您不用为执行相同的任务而重写代码)。这些实践经验在软件世界中是至关重要的，也应该应用在您的生物信息学工作中。最简单的方法是，为代码添加必要的注释和采用样式指南。Google有适用于多种语言的[公共风格的指南](https://github.com/google/styleguide)，这些指南是很好的模板。为什么代码的可读性如此重要？首先，可读的代码使项目更容易重现，因为其他人可以更容易地理解脚本的作用和运行方式。其次，在可读的、注释良好的代码中查找和纠正软件错误要比混乱的代码容易得多。第三，当代码有很好的注释和清晰的编写时，有利于将来重新访问代码。编写模块化和可重用的代码需要练习-我们将在整本书中看到这方面的一些示例。

&emsp;&emsp;与代码相反，数据应该以便于计算机读取的结构展现。通常情况下，作为人类记录数据的方式最大限度地提高数据对我们的可读性，但在计算机处理数据之前，需要进行大量的清洗和整理。计算机可读的数据(和元数据)越多，我们就越能利用计算机来处理这些数据。

### 让计算机替你工作

&emsp;&emsp;做死记硬背活动的人往往会犯许多错误。使你的工作更加健壮的最简单的方法之一是都让计算机去做这些需要死记硬背的工作。这种自动化任务的方法更健壮，因为它减少了您犯小错误的可能性，例如意外遗漏文件或不正确地命名输出变量。

&emsp;&emsp;例如，通过逐个键入(或复制并粘贴)每个命令来在20个不同的文件上运行程序是脆弱的-处理的每个文件都会增加犯粗心错误的可能性。在生物信息学工作中，养成让你的计算机为你做这种重复性工作的习惯是很好的。与其将相同的命令粘贴20次，然后只更改输入和输出文件，不如编写一个脚本来执行这一过程。这不仅更容易，减少错误率，而且还增加了可重复性，因为您的脚本可以作为您对每个文件所做操作的参考。

&emsp;&emsp;在组织项目、数据和代码的同时，需要考虑利用自动化处理任务的好处。简单的习惯，比如以一种计算机(不仅仅是人类)可以理解的一致的方式命名数据文件，可以极大地促进任务的自动化，也能使工作变得更容易。我们将在第2章看到这方面的示例。

### 在代码和方法中合理的进行断言

&emsp;&emsp;当编写代码时，我们倾向于对我们的数据有隐含的假设。例如，我们预期只有三个DNA链选项(正向，反向和未知)，基因的起始位置小于结束位置，并且我们不能有负的位置。我们对数据所做的这些隐含的假设会影响我们编写代码的方式；例如，如果我们假设某一情况不会发生，我们就不会考虑在代码中处理该情况。不幸的是，这可能会导致可怕的静默错误：我们的代码或程序接收超出期望值的值，虽然这是不正确的，但仍然在没有警告的情况下返回输出。防止这类错误的最好方法是使用Python中的assert()语句或者R的stopifnot()在代码中显式地声明和测试我们对数据的假设。

&emsp;&emsp;几乎每种编程语言都有自己版本的assert函数。这些assert函数的操作方式基本类似：如果语句的计算结果为false，assert函数将停止程序运行并触发错误警示。这些处理虽然很简单，但是这些断言函数在健壮性研究中是必不可少的。在我职业生涯的早期，一位导师鼓励我养成使用断言的习惯-即使某快程序看起来绝对不可能是假的-直到我多次遇到这种奇妙的错误之后，才对这句话表示了认同。在生物信息学中(以及所有领域)，我们要尽可能多地将可怕的无声错误转化为响亮的错误，这一点至关重要。

### 测试代码，最好是让代码测试代码

&emsp;&emsp;软件工程师是一群聪明的人，他们把让电脑为自己工作的想法提升到一个新的水平。他们实践者一想法的第一个方面就是让代码测试其他代码，而不是手动测试。测试代码的一种常用方法称为单元测试。在单元测试中，将我们的代码分解成单独的模块单元(这也可以提高代码的可读性)，然后编写额外的代码来测试这段代码。在实践中，如果我们有一个名为add()的函数，我们将编写一个名为test_add()的附加函数(通常在单独的文件中)。这个test_add()函数将使用特定的输入调用add()函数，并测试输出是否符合预期。在Python中的使用示例如下所示：

``` python
EPS = 0.00001 #比较浮点值时使用的小数字
def add(x,y):
	"""
	求两个数的和
	"""
	return x + y
def test_add():
	"""测试add()函数是否适用于各种数值类型。"""
	print('test')
	assert(add(2,3) == 5)
	assert(add(2,-3) == -1)
	assert(add(-2,-3) == -5)
	assert(add(2.1,0.33) == 2.43)
	print(abs(add(2.4,0.1)-2.5))
	assert(abs(add(2.4,0.1)-2.5) < EPS)
if __name__ == "__main__":
	test_add()
```

&emsp;&emsp;test_add()函数的最后一行比较的是浮点数，所以他看起来比其他行更复杂。在计算机上因为存在表示和舍入误差，所以比较浮点值是比较困难的。然而，这是一个很好的提醒，我们在利用计算机进行分析时，不仅需要记住计算机能做什么还要记住计算机不能做什么。

&emsp;&emsp;尽管科学代码可能会包含更多的bug(因为我们的代码通常只为了生成出版物的结果而运行一次，并且科学代码中的许多错误都是沉默的)，但是在科学编码中使用单元测试比在软件行业中使用的要少得多。我把这称为科学编码的悖论：科学编码容易出现bug的本质意味着我们应该使用与软件行业一样多或更多的测试，但实际上我们做的测试要少得多(如果有的话)。这是令人遗憾的，因为现在许多科学结论都是堆积如山的代码的结果。

&emsp;&emsp;虽然测试代码是发现、修复和防止软件错误的最好方法，但测试的成本并不低。虽然测试代码使我们的结果变的更健壮，但是测试本身会耗费我们大量的时间。不幸的是，对于研究人员来说，为他们编写的每一段代码编写单元测试将花费太多的时间。科学飞速发展，在编写和执行单元测试的过程中，您的研究可能会变得过时或被抢占。更明智的策略是每次编写代码时，认真考虑如下三个问题：

1. 这个代码将会被其他代码调用几次？
2.  如果这段代码出现异常，会对结果产生多大的影响？
3.  如果错误发生了，是否会被及时发现？

&emsp;&emsp;测试一段代码的重要性与前两个问题成正比，与第三个问题成反比（即，如果bug非常明显，则么有理由为它编写测试代码）。我们将在正本书中使用这个策略。

### 尽可能使用现有的库

&emsp;&emsp;在每个初出茅庐的程序员的职业生涯中都有一个转折点，当他们觉得编写代码足够舒服时，他们会想，“嘿，我为什么要用一个库来做这个，我可以很容易地自己写这个。”这是一种令人兴奋的感觉，但是有很好的理由使用现有的软件库来代替。
    
&emsp;&emsp;与您自己编写的库相比，现有的开源库有两个优势：历史更长，受众更广。这两个优点使现有库出现bug的概率降低。软件中的bug类似于众所周知的大海捞针的问题。如果你编写自己的软件库(其中肯定潜伏着几个bug)，你就是一个人在寻找几根针。相反，开放源码软件库在本质上就像是已经有更多的人为那些针头寻找更长的时间。因此，在这些开放源代码库中发现、报告和修复错误的可能性比您自己自制的版本更大。

&emsp;&emsp;这方面的一个很好的例子是在编写脚本将核苷酸翻译成蛋白质时出现的一个潜在的微妙问题。大多数具有一定编程经验的生物学家都可以轻松地编写脚本来完成这项任务。但是在这些简单的编程练习背后隐藏着隐藏的复杂性，您可能不会单独考虑。如果你的核苷酸序列中含有NS怎么办？还是Ys？还是Ws？NS，Ys和Ws可能看起来不是有效的碱基，但这些是国际纯粹和应用化学联合会(IUPAC)标准的含糊核苷酸，在生物信息学中是完全有效的。在许多情况下，经过良好审查的软件库已经发现并修复了这些隐藏的问题。

### 将数据视为只读数据

&emsp;&emsp;许多科学家花费大量时间使用Excel，不眨眼就会改变单元格中的值并保存结果。我强烈反对以这种方式修改数据。相反，更好的方法是将所有数据视为只读，只允许程序读取数据并创建新的、单独的结果文件。
    
&emsp;&emsp;为什么将数据视为只读在生物信息学中很重要？首先，就地修改数据很容易导致结果偏移较大。例如，假设您编写了一个直接修改文件的脚本。在处理大文件的中途，您的脚本遇到错误并崩溃。因为您已经修改了原始文件，所以您不能撤消更改并重试(除非您有备份)！基本上，此文件已损坏，无法再使用。
    
&emsp;&emsp;其次，当我们就地修改文件时，很容易忘记我们是如何更改文件的。与每个步骤都有输入文件和输出文件的工作流不同，就地修改的文件不会给出我们对它做了什么的任何指示。如果我们忘记了我们是如何更改文件的，并且没有原始数据的备份副本，那么我们的更改基本上是不可复制的。
    
&emsp;&emsp;对于经常使用Excel来工作的科学家，将数据视为只读似乎是违反直觉的，但它对于健壮的研究(防止灾难，并有助于复现)是必不可少的。最初的困难是很值得的；除了保护数据不受损坏和不正确的更改之外，它还可以提高数据的可再现性。此外，因为程序不会更改输入数据，可以轻松地重做分析的任何步骤。
花时间将常用脚本开发为工具
    
&emsp;&emsp;作为一名高级生物信息学家，在整个开发过程中，很定会有一些经常且多次使用的脚本。这些脚本可能是从数据库下载数据，或者处理某种类型的文件，或者只是生成同样漂亮的图形。这些脚本可以与实验室成员共享，甚至可以跨实验室共享。您应该投入额外的时间和精力，尽可能的完善这些高使用率或高度共享的脚本。在实践中，我认为这就是把一次性的脚本变成工具的过程。
    
&emsp;&emsp;与脚本不同，工具可以多次运行。它们在共享的版本控制存储库中有良好的文档记录，具有明确的版本控制，具有可理解的命令行参数。这些看起来可能是细微的差异，但稳健的研究就是做一些小事，这样做有利于减少错误。加大开发和研究重复应用于大量数据集的脚本，并增加他们的健壮性且利于使用，会影响更多分析的结果。尤其是您与其他研究人员共享的脚本，这些研究人员需要能够查阅文档并将您的工具安全地应用于他们自己的数据。虽然开发工具是一个比编写一次性脚本更耗费人力的过程，但从长远来看，它可以节省时间并能避免许多令人头疼的问题。

### 让数据证明它是高质量的
    
&emsp;&emsp;当科学家考虑分析数据时，他们通常会考虑分析实验数据以得出生物学结论。然而，要进行稳健的生物信息学工作，我们实际上需要分析的不仅仅是实验数据。这包括检查和分析关于实验数据质量的数据，来自生物信息学程序的中间输出文件，以及可能的模拟测试数据。这样做可以确保我们的数据处理按照我们的预期发挥作用，并体现了生物信息学的金科玉律：不要相信你的工具或数据。
    
&emsp;&emsp;千万不要假设数据集是高质量的，这一点很重要。相反，应该通过探索性数据分析(称为EDA)来证明数据的质量。EDA并不复杂或耗时，并且足够健壮来支持你研究大型数据集中隐藏的内容。我们将在第8章中学习更多关于如何使用EDA的内容。

### 可复现性研究的建议
    
&emsp;&emsp;采用可重复的研究实践并不需要太多额外的努力。就像健壮的研究实践一样，可重现的方法最终会让你的工作变得更容易，因为你自己可能需要在忘记细节很久之后重现你过去的工作。以下是练习生物信息学时要考虑的一些能使你的工作具有可复现性的基本建议。
发布代码和数据
    
&emsp;&emsp;为了可再现性，最低要求是及时发布代码和数据。如果没有可用的代码和数据，您的研究就无法重现(关于这一点，请参阅Peng，2001)。稍后我们将在本书中讨论如何共享代码和数据。

### 记录一切
    
&emsp;&emsp;科学家走进实验室的第一天，他们被告知要保存实验室笔记本。可悲的是，这种良好的实践经常被计算领域的研究人员抛弃。发布代码和数据是可重复性的最低要求，但广泛的文档也是可重复性的重要组成部分。为了完全重现一项研究，分析的每一个步骤都必须比在一篇学术文章中描述的更详细。因此，对于可再现性的研究大量的文档是必不可少的。

&emsp;&emsp;一个好做法是将每个分析步骤记录在纯文本README文件中。与详细的实验室笔记本一样，此文档可作为您的操作步骤、文件的位置、来自何处或包含的内容的有价值的记录。该文档可以与项目的代码和数据一起存储(我们将在第2章和第5章中看到更多有关这方面的内容)，这可以帮助合作者了解您所做的事情。文档还应该包括执行的每个程序的所有输入参数，这些程序的版本，以及它们是如何运行的。现代的软件，如R和IPython笔记本是记录研究的有力工具；我在本章github上的README文件中列举了一些如何使用这些工具的资料。

### 对脚本的结果进行数据化并统计
    
&emsp;&emsp;确保科学项目是可重现的，不仅仅涉及对研究结果重要的关键统计检验的可重复性-论文的支持要素(例如，数据和图表)也应该是可重现的。确保这些组件可重现的最好方法是让每个图像或表都是一个(或多个)脚本的输出。
    
&emsp;&emsp;与在Excel或R中以交互方式生成图像和表格相比，编写脚本来生成图像和表格似乎是一个更耗时的过程。然而，如果您曾经在更改了之前的步骤后手动重新生成多个数字，那么您就知道这种方法的优点。生成表和图像的脚本可以很容易地重新运行，节省您的时间，并使您的研究更具可重复性。像IPython笔记本和编织(在前一节中提到)这样的工具也在这些任务中起到了很大的帮助。

### 使用代码作为文档
    
&emsp;&emsp;对于复杂的处理管道，最好的文档通常是代码化的文档。因为代码足以告诉计算机如何执行程序(以及使用哪些参数)，它也可以告诉人类如何再现你的研究内容(像软件版本和输入数据这样的附加信息也是完全可复制的)。在许多情况下，编写脚本来执行分析的关键步骤可能比输入命令然后将其记录在其他地方更容易。同样，代码是一件奇妙的事情，使用代码来记录分析的每个步骤意味着如果必要的话，可以很容易地重新运行分析的所有步骤-脚本只需重新运行即可。

### 不断提高您的生物信息学数据技能
    
&emsp;&emsp;在读完本书的其余部分时，请将本章中介绍的基本思想放在脑后。我在这里介绍的内容仅足以让您开始思考健壮和可重现的生物信息学中的一些核心概念。其中的许多主题(例如，可再现性和软件测试)目前仍在积极研究，我鼓励感兴趣的读者更深入地研究这些主题(我在GitHub关于本章内容的[README]()文件中包含了一些相应的学习资源)。